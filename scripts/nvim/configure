#!/bin/bash -e

INIT_VIM=$HOME/.config/nvim/init.vim
COC_SETTINGS=$HOME/.config/nvim/coc-settings.json
COC_SNIPPETS=$HOME/.config/coc/ultisnips

if [ ! -e "$INIT_VIM" ]; then
    mkdir -p $HOME/.config/nvim/
fi

if [ ! -f "~/.local/share/nvim/site/autoload/plug.vim"  ]; then
    curl -fLo ~/.local/share/nvim/site/autoload/plug.vim --create-dirs \
        https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
fi
ln -s $DOTFILES/nvim/init.vim $INIT_VIM

# setup coc settings
if [ ! -e "$COC_SETTINGS" ]; then
    ln -s $DOTFILES/nvim/coc-settings.json $COC_SETTINGS
fi

# setup coc snippets
if [ ! -d "$COC_SNIPPETS" ]; then
    mkdir -p $COC_SNIPPETS
fi
if [ ! -e "$COC_SNIPPETS"/go.snippets ]; then
    ln -s $DOTFILES/nvim/ultisnips/go.snippets $COC_SNIPPETS/go.snippets
fi

# Install python lsp
pip install --user python-language-server
python -m venv ~/.config/nvim/venv
~/.config/nvim/venv/bin/pip install pynvim

# Install bash lsp
npm i -g bash-language-server

# Install docker lsp
npm install -g dockerfile-language-server-nodejs

# nvim +PlugInstall +qall # TODO check why generate error reading from input
